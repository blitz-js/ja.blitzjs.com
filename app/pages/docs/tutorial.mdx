---
title: ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«
sidebar_label: ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«
---

ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã€åŸºæœ¬çš„ãªæŠ•ç¥¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆæ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

ã“ã“ã§ã¯ã€ã™ã§ã« Blitz ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹( [Blitz ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•](./get-started]) ã‚’å‚ç…§ãã ã•ã„)ã“ã¨ã‚’å‰æã¨ã—ã¾ã™ã€‚Blitz ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã¯ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã‚ã‹ã‚Šã¾ã™ã€‚

```sh
blitz -v
```

Blitz ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚Œã°ã€ãã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€"command not found: blitz "ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

## æ–°ã—ã„ Blitz ã‚¢ãƒ—ãƒªã®ä½œæˆ {#creating-a-new-app}

ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§`cd` ã‚³ãƒãƒ³ãƒ‰ã‚’ç”¨ã„ã€ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ãŸã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```sh
blitz new my-blitz-app
```

Blitz ã¯ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã« `my-blitz-app` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ã€‚ã™ã‚‹ã¨ã€ãƒ•ã‚©ãƒ¼ãƒ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’é¸æŠã™ã‚‹ã‚ˆã†ã«ä¿ƒã•ã‚Œã¾ã™ã€‚ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã€æ¨å¥¨ã—ã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª `React Final Form` ã‚’é¸æŠã—ã¾ã™ã€‚

ãã‚Œã§ã¯ã€`blitz new`ãŒä½œæˆã—ãŸã‚‚ã®ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
my-blitz-app
â”œâ”€â”€ app/
â”‚Â Â  â”œâ”€â”€ api/
â”‚Â Â  â”œâ”€â”€ auth/
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ components/
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ LoginForm.tsx
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ SignupForm.tsx
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ mutations/
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ changePassword.ts
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ forgotPassword.test.ts
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ forgotPassword.ts
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ login.ts
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ logout.ts
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ resetPassword.test.ts
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ resetPassword.ts
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ signup.ts
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ pages/
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ forgot-password.tsx
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ login.tsx
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ reset-password.tsx
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ signup.tsx
â”‚Â Â  â”‚Â Â  â””â”€â”€ validations.ts
â”‚Â Â  â”œâ”€â”€ core/
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ components/
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Form.tsx
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ LabeledTextField.tsx
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ hooks/
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ useCurrentUser.ts
â”‚Â Â  â”‚Â Â  â””â”€â”€ layouts/
â”‚Â Â  â”‚Â Â      â””â”€â”€ Layout.tsx
â”‚Â Â  â”œâ”€â”€ pages/
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ 404.tsx
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ _app.tsx
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ _document.tsx
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.test.tsx
â”‚Â Â  â”‚Â Â  â””â”€â”€ index.tsx
â”‚Â Â  â””â”€â”€ users/
â”‚Â Â      â””â”€â”€ queries/
â”‚Â Â          â””â”€â”€ getCurrentUser.ts
â”œâ”€â”€ db/
â”‚Â Â  â”œâ”€â”€ index.ts
â”‚Â Â  â”œâ”€â”€ schema.prisma
â”‚Â Â  â””â”€â”€ seeds.ts
â”œâ”€â”€ integrations/
â”œâ”€â”€ mailers/
â”‚Â Â  â””â”€â”€ forgotPasswordMailer.ts
â”œâ”€â”€ public/
â”‚Â Â  â”œâ”€â”€ favicon.ico*
â”‚Â Â  â””â”€â”€ logo.png
â”œâ”€â”€ test/
â”‚Â Â  â”œâ”€â”€ setup.ts
â”‚Â Â  â””â”€â”€ utils.tsx
â”œâ”€â”€ README.md
â”œâ”€â”€ babel.config.js
â”œâ”€â”€ blitz.config.js
â”œâ”€â”€ jest.config.js
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ types.d.ts
â”œâ”€â”€ types.ts
â””â”€â”€ yarn.lock
```

ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

- `app/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã€ãƒšãƒ¼ã‚¸ã‚„ API ãƒ«ãƒ¼ãƒˆãªã©ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å¤šãã®ã‚‚ã®ãŒé…ç½®ã•ã‚Œã‚‹å ´æ‰€ã§ã™ã€‚

- `app/pages/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã€ä¸»è¦ãªãƒšãƒ¼ã‚¸ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã™ã€‚Next.js ã‚’ä½¿ã£ãŸã“ã¨ãŒã‚ã‚‹äººãªã‚‰ã€ã“ã®é•ã„ã«ã™ãã«æ°—ã¥ãã§ã—ã‚‡ã†ã€‚Blitz ã§ã¯å¤šãã®`pages`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒã¤ã“ã¨ãŒã§ãã€ãã‚Œã‚‰ã¯ãƒ“ãƒ«ãƒ‰æ™‚ã«ãƒãƒ¼ã‚¸ã•ã‚Œã¾ã™ã€‚

- `app/core/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã€ã‚¢ãƒ—ãƒªå…¨ä½“ã§ä½¿ç”¨ã•ã‚Œã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚„ãƒ•ãƒƒã‚¯ãªã©ã‚’ç½®ãä¸»ãªå ´æ‰€ã§ã™ã€‚

- `db/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è¨­å®šã‚’ç½®ãå ´æ‰€ã§ã™ã€‚ãƒ¢ãƒ‡ãƒ«ã‚’æ›¸ã„ãŸã‚Šã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸã‚Šã™ã‚‹å ´åˆã¯ã€ã“ã“ã«è¡Œãã¾ã™ã€‚

- `public/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã€é™çš„ã‚¢ã‚»ãƒƒãƒˆã‚’ç½®ãå ´æ‰€ã§ã™ã€‚ã‚¢ãƒ—ãƒªã§ä½¿ç”¨ã™ã‚‹ç”»åƒãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»å‹•ç”»ãŒã‚ã‚‹å ´åˆã¯ã€ã“ã“ã«é…ç½®ã—ã¾ã™ã€‚

- `.babelrc.js`ã€`.env`ãªã© (ã¤ã¾ã‚Šã€ãƒ‰ãƒƒãƒˆã‹ã‚‰å§‹ã¾ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«) ã¯ã€JavaScript ãƒ„ãƒ¼ãƒ«ã®æ§˜ã€…ãªè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚

- `blitz.config.js` ã¯ã€Blitz ã®é«˜åº¦ãªã‚«ã‚¹ã‚¿ãƒ è¨­å®šã‚’è¡Œã†ãŸã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯`next.config.js` ã¨åŒã˜ã§ã™ã€‚

- `tsconfig.json` ã¯ã€TypeScript ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚æ¨å¥¨ã®åˆæœŸè¨­å®šãŒã•ã‚Œã¦ã„ã¾ã™ã€‚

## é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ {#the-development-server}

ãã‚Œã§ã¯ã€`my-blitz-app` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚ã¾ã  `my-blitz-app` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```sh
blitz dev
```

ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã«ã¯ã€æ¬¡ã®ã‚ˆã†ãªå‡ºåŠ›ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```sh
âœ” Compiled
Loaded env from /private/tmp/my-blitz-app/.env
warn  - You have enabled experimental feature(s).
warn  - Experimental features are not covered by semver, and may cause unexpected or broken application behavior. Use them at your own risk.

ready - started server on 0.0.0.0:3000, url: http://localhost:3000
info  - Using external babel configuration from /my-blitz-app/babel.config.js
event - compiled successfully
```

ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ãŸã‚‰ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ [localhost:3000](http://localhost:3000) ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚
Blitz ã®ãƒ­ã‚´ãŒå…¥ã£ãŸã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã†ã¾ãã„ãã¾ã—ãŸã­ï¼

## ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ç™»éŒ²ã™ã‚‹ {#sign-up-as-a-user}

Blitz ã‚¢ãƒ—ãƒªã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ã‚„ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ãŒã™ã§ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ï¼
æ—©é€Ÿè©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚**Sign Up** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚ä»»æ„ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€**Create Account**ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚ãã†ã™ã‚‹ã¨ã€ã‚ãªãŸã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã® `id` ã¨ `role` ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¾ã™ã€‚

å¿…è¦ã§ã‚ã‚Œã°ã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¦ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã—ç›´ã™ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ã‚ã‚‹ã„ã¯ã€ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã® **Forgot your password?** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚ŒãŸå ´åˆã®ãƒ•ãƒ­ãƒ¼ã‚’è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

## æœ€åˆã®ãƒšãƒ¼ã‚¸ã®å®Ÿè£… {#write-your-first-page}

æ¬¡ã«ã€æœ€åˆã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

`app/pages/index.tsx` ã‚’é–‹ãã€`Home` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å†…å®¹ã‚’æ¬¡ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```tsx
//...

const Home: BlitzPage = () => {
  return (
    <div>
      <h1>Hello, world!</h1>

      <Suspense fallback="Loading...">
        <UserInfo />
      </Suspense>
    </div>
  )
}

//...
```

<<<<<<< HEAD
ä¿å­˜ã™ã‚‹ã¨ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒšãƒ¼ã‚¸ãŒæ›´æ–°ã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚ã“ã®ã‚ˆã†ã«ã—ã¦ãƒšãƒ¼ã‚¸ã‚’å¥½ããªã‚ˆã†ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚æº–å‚™ãŒã§ããŸã‚‰ã€æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚
=======
Save the file and you should see the page update in your browser. You can
customize this as much as you want. When youâ€™re ready, move on to the next
section.
>>>>>>> 70a4ef1de11636f6d26d6c46ccbd29b5c68fecd5

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è¨­å®š {#database-setup}

å¬‰ã—ã„ã“ã¨ã«ã€SQLite ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒè¨­å®šæ¸ˆã¿ã§ã™ã€‚ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§`blitz prisma studio` ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹ Web ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒé–‹ãã¾ã™ã€‚

æœ¬æ ¼çš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å§‹ã‚ã‚‹ã¨ãã«ã¯ã€é‹ç”¨ã®é€”ä¸­ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆ‡ã‚Šæ›¿ãˆã®æ‰‹é–“ã‚’çœããŸã‚ã€åˆã‚ã‹ã‚‰ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆä¾‹ãˆã°ã€PostgreSQL ãªã©ï¼‰ã‚’ä½¿ç”¨ã—ãŸæ–¹ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€[ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ¦‚è¦](database-overview) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® SQLite ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

## ãƒ¢ãƒ‡ãƒ«ã®ã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•ç”Ÿæˆ {#scaffolding-code-for-our-models}

Blitz ã«ã¯ [`generate`](./cli-generate) ã¨ã„ã†ã‚³ãƒ¼ãƒ‰è‡ªå‹•ç”Ÿæˆã«ä¾¿åˆ©ãª CLI ã‚³ãƒãƒ³ãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚ã“ã“ã§ã¯ã€`generate`ã‚’ä½¿ã£ã¦ `Question`ï¼ˆè³ªå•ï¼‰ã¨ `Choice`ï¼ˆé¸æŠè‚¢ï¼‰ã® 2 ã¤ã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚ `Question` ã¯è³ªå•ã®ãƒ†ã‚­ã‚¹ãƒˆã¨é¸æŠè‚¢ã®ãƒªã‚¹ãƒˆã‚’æŒã¡ã¾ã™ã€‚`Choice`ã«ã¯ã€é¸æŠè‚¢ã®ãƒ†ã‚­ã‚¹ãƒˆã€æŠ•ç¥¨æ•°ã€é¸æŠè‚¢ã«ç´ä»˜ãè³ªå•ãŒå«ã¾ã‚Œã¾ã™ã€‚Blitz ã¯ä¸¡æ–¹ã®ãƒ¢ãƒ‡ãƒ«ã«ã¤ã„ã¦ã€IDã€ä½œæˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã€æœ€çµ‚æ›´æ–°ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è‡ªå‹•çš„ã«ç”Ÿæˆã—ã¾ã™ã€‚

#### Step1: `Question` ãƒ¢ãƒ‡ãƒ«ã«é–¢é€£ã™ã‚‹ç”Ÿæˆ

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§`Question` ãƒ¢ãƒ‡ãƒ«ã‚’ç”Ÿæˆã—ã¾ã—ã‚‡ã†ã€‚

```sh
blitz generate all question text:string
```

ã‚³ãƒãƒ³ãƒ‰ã®å…¥åŠ›ã‚’ä¿ƒã•ã‚ŒãŸã‚‰ã€**Enter** ã‚’æŠ¼ã—ã¦ `prisma migrate` ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®åå‰ã‚’èã‹ã‚Œã‚‹ã®ã§ã€"add question" ã¨å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

```
CREATE    app/pages/questions/[questionId].tsx
CREATE    app/pages/questions/[questionId]/edit.tsx
CREATE    app/pages/questions/index.tsx
CREATE    app/pages/questions/new.tsx
CREATE    app/questions/components/QuestionForm.tsx
CREATE    app/questions/queries/getQuestion.ts
CREATE    app/questions/queries/getQuestions.ts
CREATE    app/questions/mutations/createQuestion.ts
CREATE    app/questions/mutations/deleteQuestion.ts
CREATE    app/questions/mutations/updateQuestion.ts

âœ” Model for 'question' created in schema.prisma:

> model Question {
>   id        Int      @default(autoincrement()) @id
>   createdAt DateTime @default(now())
>   updatedAt DateTime @updatedAt
>   text      String
> }

? Run 'prisma migrate dev' to update your database? (Y/n) â€º true
```

```
Environment variables loaded from .env
Prisma schema loaded from db/schema.prisma
Datasource "db": SQLite database "db.sqlite" at "file:./db.sqlite"

âœ” Name of migration â€¦ add question
The following migration(s) have been created and applied from new schema changes:

migrations/
  â””â”€ 20210217035805_add_question/
    â””â”€ migration.sql

âœ” Generated Prisma Client (2.17.0) to ./node_modules/@prisma/client in 103ms

Everything is now in sync.
```

`generate` ã‚³ãƒãƒ³ãƒ‰ã« `all` å‹ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ãƒ¢ãƒ‡ãƒ«ã¨ã‚¯ã‚¨ãƒªã€Mutationã€ãƒšãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚åˆ©ç”¨å¯èƒ½ãªå‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ä¸€è¦§ã¯ [Blitz generate](./cli-generate) ã®ãƒšãƒ¼ã‚¸ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

#### Step2: `Choice` ãƒ¢ãƒ‡ãƒ«ã¨ãã‚Œã«å¯¾å¿œã™ã‚‹ã‚¯ã‚¨ãƒªã¨ Mutation ã®ç”Ÿæˆ

ä»Šå›ã¯ `Choice` ãƒ¢ãƒ‡ãƒ«ã®ãƒšãƒ¼ã‚¸ã‚’ç”Ÿæˆã™ã‚‹å¿…è¦ãŒãªã„ã®ã§ã€`resource` ã®å‹ã‚’æ¸¡ã™ã“ã¨ã«ã—ã¾ã™ã€‚

```sh
blitz generate resource choice text votes:int:default=0 belongsTo:question
```

If you get an error run `blitz prisma format`

<<<<<<< HEAD
ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ä¿ƒã•ã‚ŒãŸã‚‰ã€å†åº¦ **Enter** ã‚’æŠ¼ã—ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®åå‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚
=======
Note that this doesn't require a database migration because we haven't
added the `Choice` field to the `Question` model yet. So we are choosing
`false` when prompted to run the migration:
>>>>>>> 70a4ef1de11636f6d26d6c46ccbd29b5c68fecd5

```
CREATE    app/choices/queries/getChoice.ts
CREATE    app/choices/queries/getChoices.ts
CREATE    app/choices/mutations/createChoice.ts
CREATE    app/choices/mutations/deleteChoice.ts
CREATE    app/choices/mutations/updateChoice.ts

âœ” Model for 'choice' created in schema.prisma:

> model Choice {
>   id         Int      @default(autoincrement()) @id
>   createdAt  DateTime @default(now())
>   updatedAt  DateTime @updatedAt
>   text       String
>   votes      Int      @default(0)
>   question   Question @relation(fields: [questionId], references: [id])
>   questionId Int
> }

? Run 'prisma migrate dev' to update your database? (Y/n) â€º false
```

#### Step3: `Question` ãƒ¢ãƒ‡ãƒ«ã‚’æ›´æ–°ã—ã¦ `Choice` ã¨ã®é–¢ä¿‚ã‚’æŒãŸã›ã‚‹

`db/schema.prisma` ã‚’é–‹ãã€`Question` ãƒ¢ãƒ‡ãƒ«ã« `choices Choice[]` ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```diff
model Question {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  text      String
+ choices   Choice[]
}
```

<<<<<<< HEAD
ãã—ã¦ã€`blitz prisma generate`ã‚’å®Ÿè¡Œã—ã¦ã€ã‚¹ã‚­ãƒ¼ãƒã®å¤‰æ›´ã«åˆã‚ã›ã¦ prisma ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’æ›´æ–°ã—ã¾ã™ã€‚
ä»Šå›ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã® `Question` ãƒ¢ãƒ‡ãƒ«ã«å®Ÿéš›ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒè¿½åŠ ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¿…è¦ã¨ã—ã¾ã›ã‚“ã€‚
=======
Now we can run the migration to update our database:

```sh
blitz prisma migrate dev
```

And again, enter a name for the migration, like "add choice":

```
Environment variables loaded from .env
Prisma schema loaded from db/schema.prisma
Datasource "db": SQLite database "db.sqlite" at "file:./db.sqlite"

âœ” Name of migration â€¦ add choice
The following migration(s) have been created and applied from new schema changes:

migrations/
  â””â”€ 20210412175528_add_choice/
    â””â”€ migration.sql

Your database is now in sync with your schema.
```

Now our database is ready and a Prisma client is also generated. Lets move
on to play with the Prisma client!
>>>>>>> 70a4ef1de11636f6d26d6c46ccbd29b5c68fecd5

## Prisma ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’è©¦ã™ {#playing-with-the-prisma-database-client}

ã“ã“ã§ã€å¯¾è©±å‹ã® Blitz ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ã€Blitz ãŒæä¾›ã™ã‚‹ Prisma ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§éŠã‚“ã§ã¿ã¾ã—ã‚‡ã†ã€‚Blitz ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’èµ·å‹•ã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```sh
blitz console
```

ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å…¥ã£ãŸã‚‰ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½¿ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```sh
# è³ªå•ã¯ã¾ã å­˜åœ¨ã—ã¦ã„ã¾ã›ã‚“ã€‚
âš¡ > await db.question.findMany()
[]

# è³ªå•ã‚’ä½œæˆã—ã¾ã™ã€‚
âš¡ > let q = await db.question.create({data: {text: "What's new?"}})
undefined

# ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
âš¡ > q
{
  id: 1,
  createdAt: 2020-06-15T15:06:14.959Z,
  updatedAt: 2020-06-15T15:06:14.959Z,
  text: "What's new?"
}

# ã¾ãŸã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä¸Šã®å€‹ã€…ã®å€¤ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚
âš¡ > q.text
"What's new?"

# updateé–¢æ•°ã‚’ä½¿ç”¨ã—ã¦å€¤ã‚’å¤‰æ›´ã—ã¾ã™ã€‚
âš¡ > q = await db.question.update({where: {id: 1}, data: {text: "What's up?"}})
{
  id: 1,
  createdAt: 2020-06-15T15:06:14.959Z,
  updatedAt: 2020-06-15T15:13:17.394Z,
  text: "What's up?"
}

# db.question.findMany()ã‚’å†åº¦å®Ÿè¡Œã™ã‚‹ã¨ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«è¿½åŠ ã•ã‚ŒãŸã™ã¹ã¦ã®è³ªå•ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
âš¡ > await db.question.findMany()
[
  {
    id: 1,
    createdAt: 2020-06-15T15:06:14.959Z,
    updatedAt: 2020-06-15T15:13:17.394Z,
    text: "What's up?"
  }
]
```

## ãƒ¢ãƒ‡ãƒ«å±æ€§ç”¨ã«ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–° {#update-generated-code-for-our-model-attributes}

<<<<<<< HEAD
<!-- prettier-ignore-start -->
:::info
ã‚¢ãƒ—ãƒªã‚’å†åº¦å®Ÿè¡Œã™ã‚‹å‰ã«ã€ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã®ä¸€éƒ¨ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å°†æ¥çš„ã«ã¯ã“ã‚Œã‚‰ã®ä¿®æ­£ã‚’ã™ã‚‹å¿…è¦ã¯ç„¡ããªã‚Šã¾ã™ãŒã€ä»Šã®ã¨ã“ã‚ã¯ã„ãã¤ã‹ã®æœªè§£æ±ºã®å•é¡Œã‚’å›é¿ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
:::
<!-- prettier-ignore-end -->
=======
<Card type="info">

Before running the app again, we need to customize some of the code that
has been generated. Ultimately, these fixes will not be needed - but for
now, we need to work around a couple outstanding issues.

</Card>
>>>>>>> 70a4ef1de11636f6d26d6c46ccbd29b5c68fecd5

ç”Ÿæˆã•ã‚ŒãŸãƒšãƒ¼ã‚¸ã®å†…å®¹ã¯ã€ç¾åœ¨ã®ã¨ã“ã‚ã€ç”Ÿæˆæ™‚ã«å®šç¾©ã—ãŸå®Ÿéš›ã®ãƒ¢ãƒ‡ãƒ«å±æ€§ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã›ã‚“ã€‚ã™ãã«ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ãŒã€ãã‚Œã¾ã§ã®é–“ã¯ç”Ÿæˆã•ã‚ŒãŸãƒšãƒ¼ã‚¸ã‚’ä¿®æ­£ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

### è³ªå•ãƒšãƒ¼ã‚¸ {#question-pages}

[//]: # "`generate` ãŒå®Ÿéš›ã®ãƒ¢ãƒ‡ãƒ«å±æ€§ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ã—ã¾ã—ã‚‡ã†"

`app/pages/questions/index.tsx` ã«ã‚¸ãƒ£ãƒ³ãƒ—ã—ã¦ãã ã•ã„ã€‚ `QuestionsList` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

```tsx
// app/pages/questions/index.tsx

export const QuestionsList = () => {
  const router = useRouter()
  const page = Number(router.query.page) || 0
  const [{ questions, hasMore }, { isPreviousData }] = usePaginatedQuery(
    getQuestions,
    {
      orderBy: { id: "asc" },
      skip: ITEMS_PER_PAGE * page,
      take: ITEMS_PER_PAGE,
    }
  )

  const goToPreviousPage = () =>
    router.push({ query: { page: page - 1 } })

  const goToNextPage = () => {
    if (!isPreviousData && hasMore) {
      router.push({ query: { page: page + 1 } })
    }
  }

  return (
    <div>
      <ul>
        {questions.map((question) => (
          <li key={question.id}>
            <Link href={`/questions/${question.id}`}>
              <a>{question.name}</a>
            </Link>
          </li>
        ))}
      </ul>

      <button disabled={page === 0} onClick={goToPreviousPage}>
        Previous
      </button>
      <button
        disabled={isPreviousData || !hasMore}
        onClick={goToNextPage}
      >
        Next
      </button>
    </div>
  )
}
```

ã—ã‹ã—ã€ã“ã‚Œã§ã¯ã†ã¾ãã„ãã¾ã›ã‚“ã€‚ä¸Šã§ä½œæˆã—ãŸ `Question` ãƒ¢ãƒ‡ãƒ«ã«ã¯ `name` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒãªã„ã“ã¨ã‚’ãˆã¦ãŠã„ã¦ãã ã•ã„ã€‚ã“ã‚Œã‚’ä¿®æ­£ã™ã‚‹ã«ã¯ã€`question.name` ã‚’ `question.text` ã«ç½®ãæ›ãˆã¾ã™ã€‚

```diff
// app/pages/questions/index.tsx

export const QuestionsList = () => {
  const router = useRouter()
  const page = Number(router.query.page) || 0
  const [{questions, hasMore}, {isPreviousData}] = usePaginatedQuery(
    getQuestions, {
      orderBy: {id: "asc"},
      skip: ITEMS_PER_PAGE * page,
      take: ITEMS_PER_PAGE,
    },
  )

  const goToPreviousPage = () => router.push({query: {page: page - 1}})

  const goToNextPage = () => {
    if (!isPreviousData && hasMore) {
      router.push({query: {page: page + 1}})
    }
  }

  return (
    <div>
      <ul>
        {questions.map((question) => (
          <li key={question.id}>
            <Link href={`/questions/${question.id}`}>
-              <a>{question.name}</a>
+              <a>{question.text}</a>
            </Link>
          </li>
        ))}
      </ul>

      <button disabled={page === 0} onClick={goToPreviousPage}>
        Previous
      </button>
      <button disabled={isPreviousData || !hasMore} onClick={goToNextPage}>
        Next
      </button>
    </div>
  )
}
```

æ¬¡ã«ã€åŒæ§˜ã®ä¿®æ­£ã‚’ `app/questions/components/QuestionForm.tsx` ã«ã‚‚é©ç”¨ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ãƒ•ã‚©ãƒ¼ãƒ ã®æŠ•ç¨¿ã«ãŠã„ã¦ã€`LabeledTextField` ã® `name` ã‚’ `text` ã«ç½®ãæ›ãˆã¾ã™ã€‚

```diff
export function QuestionForm<S extends z.ZodType<any, any>>(
  props: FormProps<S>,
) {
  return (
    <Form<S> {...props}>
-     <LabeledTextField name="name" label="Name" placeholder="Name" />
+     <LabeledTextField name="text" label="Text" placeholder="Text" />
    </Form>
  )
}
```

### `createQuestion` Mutation {#create-question-mutation}

`app/questions/mutations/createQuestion.ts` ã§ã€`CreateQuestion` ã® zod ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ¼ãƒã‚’æ›´æ–°ã—ã¦ `name` ã®ä»£ã‚ã‚Šã« `text` ã‚’ä½¿ã†ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```diff
// app/questions/mutations/createQuestion.ts

const CreateQuestion = z
  .object({
-   name: z.string(),
+   text: z.string(),
  })
  .nonstrict()
// ...
```

### `updateQuestion` Mutation {#update-question-mutation}

`app/questions/mutations/updateQuestion.ts` ã§ã€`UpdateQuestion` ã® zod ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ¼ãƒã‚’`name` ã®ä»£ã‚ã‚Šã« `text` ã‚’ä½¿ã†ã‚ˆã†ã«æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```diff
// app/questions/mutations/updateQuestion.ts

const UpdateQuestion = z
  .object({
    id: z.number(),
-   name: z.string(),
+   text: z.string(),
  })
  .nonstrict()
// ...
```

### `deleteQuestion` Mutation {#delete-question-mutation}

[//]: # "PrismaãŒã‚«ã‚¹ã‚±ãƒ¼ãƒ‰å‰Šé™¤ã‚’ã‚µãƒãƒ¼ãƒˆã—ãŸã‚‰ã€ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ã™ã‚‹"

Prisma ã¯ã¾ã  ã€Œã‚«ã‚¹ã‚±ãƒ¼ãƒ‰å‰Šé™¤(ç‰¹å®šã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ãŸã¨ãã«ã€é–¢é€£ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚‚ä¸€ç·’ã«å‰Šé™¤ã™ã‚‹æ©Ÿèƒ½)ã€ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã«ãŠã‘ã‚‹ã€Œã‚«ã‚¹ã‚±ãƒ¼ãƒ‰å‰Šé™¤ã®æœªå¯¾å¿œã€ã¨ã¯ã€`Question` ã‚’å‰Šé™¤ã™ã‚‹éš›ã« `Choice` ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ãªã„ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚
ã€Œ`Question`ã«é–¢é€£ã™ã‚‹`Choice`ã‚‚ä¸€ç·’ã«å‰Šé™¤ã™ã‚‹ã€ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ‰‹å‹•ã§å®Ÿè£…ã™ã‚‹ãŸã‚ã«ã¯ã€ç”Ÿæˆã•ã‚ŒãŸ`deleteQuestion` Mutation ã‚’ä¸€æ™‚çš„ã«æ‹¡å¼µã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã§`app/questions/mutations/deleteQuestion.ts` ã‚’é–‹ãã€é–¢æ•°æœ¬ä½“ã®å…ˆé ­ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

```ts
await db.choice.deleteMany({ where: { questionId: id } })
```

æœ€çµ‚çš„ã«ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚‹ã¯ãšã§ã™ã€‚

```diff
// app/questions/mutations/deleteQuestion.ts

export default resolver.pipe(
  resolver.zod(DeleteQuestion),
  resolver.authorize(),
  async ({id}) => {
+   await db.choice.deleteMany({where: {questionId: id}})
    const question = await db.question.deleteMany({where: {id}})

    return question
  },
)
```

ã“ã® Mutation ã¯ã€`Question` è‡ªä½“ã‚’å‰Šé™¤ã™ã‚‹å‰ã«ã€`Question` ã«é–¢é€£ã™ã‚‹ `Choice` ã‚’å‰Šé™¤ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

#### è³ªå•ã®ä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤ã‚’è©¦ãã†

ã„ã„ã§ã™ã­ï¼ã‚¢ãƒ—ãƒªãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚å®Ÿè¡Œã•ã‚Œã¦ã„ãªã„å ´åˆã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§`blitz dev` ã‚’å®Ÿè¡Œã—ã€`localhost:3000/questions` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚è³ªå•ã®ä½œæˆã€ç·¨é›†ã€å‰Šé™¤ã‚’è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

## è³ªå•ãƒ•ã‚©ãƒ¼ãƒ ã«é¸æŠè‚¢ã‚’è¿½åŠ ã™ã‚‹ {#adding-choices-to-the-question-form}

ãŠç–²ã‚Œæ§˜ã§ã™ï¼ æ¬¡ã¯è³ªå•ãƒ•ã‚©ãƒ¼ãƒ ã«é¸æŠè‚¢ã‚’è¿½åŠ ã—ã¾ã™ã€‚ã‚¨ãƒ‡ã‚£ã‚¿ã§`app/questions/components/QuestionForm.tsx` ã‚’é–‹ã„ã¦ãã ã•ã„ã€‚

ã•ã‚‰ã«ã€3 ã¤ã®é¸æŠè‚¢ `<LabeledTextField>` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚

```diff
export function QuestionForm<S extends z.ZodType<any, any>>(
  props: FormProps<S>,
) {
  return (
    <Form<S> {...props}>
      <LabeledTextField name="text" label="Text" placeholder="Text" />
+     <LabeledTextField name="choices.0.text" label="Choice 1" />
+     <LabeledTextField name="choices.1.text" label="Choice 2" />
+     <LabeledTextField name="choices.2.text" label="Choice 3" />
    </Form>
  )
}
```

æ¬¡ã« `app/pages/questions/new.tsx` ã‚’é–‹ãã€`initialValues` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

```diff
      <QuestionForm
        submitText="Create Question"
-       // initialValues={{ }}
+       initialValues={{choices: []}}
        onSubmit={async (values) => {
          try {
            const question = await createQuestionMutation(values)
            router.push(`/questions/${question.id}`)
          } catch (error) {
            console.error(error)
            return {
              [FORM_ERROR]: error.toString(),
            }
          }
        }}
      />
```

ãã‚Œã‹ã‚‰ `app/questions/mutations/createQuestion.ts` ã‚’é–‹ãã€Mutation ã§é¸æŠè‚¢ã®ãƒ‡ãƒ¼ã‚¿ãŒå—ã‘å…¥ã‚Œã‚‰ã‚Œã‚‹ã‚ˆã†ã« zod ã‚¹ã‚­ãƒ¼ãƒã‚’æ›´æ–°ã—ã¾ã™ã€‚ã¾ãŸã€é¸æŠè‚¢ãŒä½œæˆã•ã‚Œã‚‹ã‚ˆã†ã« `db.question.create` ã®å‘¼ã³å‡ºã—å‡¦ç†ã‚’æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```diff
// app/questions/mutations/createQuestion.ts

const CreateQuestion = z
  .object({
    text: z.string(),
+   choices: z.array(z.object({text: z.string()})),
  })
  .nonstrict()

export default resolver.pipe(
  resolver.zod(CreateQuestion),
  resolver.authorize(),
  async (input) => {
-   const question = await db.question.create({data: input})
+   const question = await db.question.create({
+     data: {
+       ...input,
+       choices: {create: input.choices},
+     },
+   })

    return question
  },
)
```

#### ãŠè©¦ã—

ã“ã‚Œã§ã€`localhost:3000/questions/new` ã‚’é–‹ã„ã¦ã€æ–°ã—ã„è³ªå•ã¨é¸æŠè‚¢ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## ãƒªã‚¹ãƒˆã®é¸æŠ {#listing-choices}

ä¼‘æ†©ã§ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã® `localhost:3000/questions` ã«æˆ»ã£ã¦ã€ä½œæˆã—ãŸã™ã¹ã¦ã®è³ªå•ã‚’è¦‹ã¦ãã ã•ã„ã€‚ã“ã‚Œã‚‰ã®è³ªå•ã«ã€é¸æŠè‚¢ã‚’ä¸€è¦§è¡¨ç¤ºã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ ã¾ãšã€è³ªå•ã®ã‚¯ã‚¨ãƒªã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
Prisma ã§ã¯ã€ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚ã‚¯ã‚¨ãƒªã«å«ã‚ã‚‹å ´åˆã«ã¯ã€æ‰‹å‹•ã§è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã‚ãªãŸã® `getQuestion.ts` ã¨ `getQuestions.ts` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

```diff
// app/questions/queries/getQuestion.ts

const GetQuestion = z.object({
  // This accepts type of undefined, but is required at runtime
  id: z.number().optional().refine(Boolean, "Required"),
})

export default resolver.pipe(
  resolver.zod(GetQuestion),
  resolver.authorize(),
  async ({id}) => {
-   const question = await db.question.findFirst({where: {id}})
+   const question = await db.question.findFirst({
+     where: {id},
+     include: {choices: true},
+   })

    if (!question) throw new NotFoundError()

    return question
  },
)
```

```diff
// app/questions/queries/getQuestions.ts

interface GetQuestionsInput
  extends Pick<
    Prisma.QuestionFindManyArgs,
    "where" | "orderBy" | "skip" | "take"
  > {}

export default resolver.pipe(
  resolver.authorize(),
  async ({where, orderBy, skip = 0, take = 100}: GetQuestionsInput) => {
    const {items: questions, hasMore, nextPage, count} = await paginate({
      skip,
      take,
      count: () => db.question.count({where}),
      query: (paginateArgs) =>
        db.question.findMany({
          ...paginateArgs,
          where,
          orderBy,
+         include: {choices: true},
        }),
    })

    return {
      questions,
      nextPage,
      hasMore,
      count,
    }
  },
)
```

ã‚¨ãƒ‡ã‚£ã‚¿ã§ãƒ¡ã‚¤ãƒ³ã®è³ªå•ãƒšãƒ¼ã‚¸ (`app/pages/questions/index.tsx`) ã«æˆ»ã£ã¦ã€å„è³ªå•ã®é¸æŠè‚¢ã‚’ä¸€è¦§è¡¨ç¤ºã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ãã—ã¦ã€ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’ `QuestionsList` ã® `Link` ã®ä¸‹ã«è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

```diff
// app/pages/questions/index.tsx

// ...
{
  questions.map((question) => (
    <li key={question.id}>
      <Link href={`/questions/${question.id}`}>
        <a>{question.text}</a>
      </Link>
+     <ul>
+       {question.choices.map((choice) => (
+         <li key={choice.id}>
+           {choice.text} - {choice.votes} votes
+         </li>
+       ))}
+     </ul>
    </li>
  ))
}
// ...
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `/questions` ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ **æœ€é«˜ã§ã™ï¼**

## è³ªå•ã«æŠ•ç¥¨ã•ã›ã‚ˆã†ï¼ {#let-people-vote-on-questions}

ã‚¨ãƒ‡ã‚£ã‚¿ã§ `app/pages/questions/[questionId].tsx` ã‚’é–‹ã„ã¦ãã ã•ã„ã€‚ã¾ãšã€ã“ã®ãƒšãƒ¼ã‚¸ã‚’ã™ã“ã—æ”¹å–„ã—ã¾ã™ã€‚

1. `<h1>Question {question.id}</h1>` ã‚’ `<h1>{question.text}</h1>` ã«ç½®ãæ›ãˆã¾ã™ã€‚

2. `pre` è¦ç´ ã‚’å‰Šé™¤ã—ã€å…ˆã»ã©æ›¸ã„ãŸé¸æŠè‚¢ãƒªã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚

```tsx
<ul>
  {question.choices.map((choice) => (
    <li key={choice.id}>
      {choice.text} - {choice.votes} votes
    </li>
  ))}
</ul>
```

ãƒ–ãƒ©ã‚¦ã‚¶ã«æˆ»ã‚‹ã¨ã€ã‚ãªãŸã®ãƒšãƒ¼ã‚¸ã¯ã“ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚

<img
  width="567"
  alt="Screenshot"
  src="https://user-images.githubusercontent.com/24858006/80387990-3c3d8b80-88a1-11ea-956a-5be85f1e8f12.png"
/>

#### æŠ•ç¥¨ã‚’è¿½åŠ ã™ã‚‹æ™‚ã§ã™ï¼

<<<<<<< HEAD
ã¾ãšã€`app/choices/mutations/updateChoice.ts` ã‚’é–‹ãã€zod ã‚¹ã‚­ãƒ¼ãƒã‚’æ›´æ–°ã—ã€æŠ•ç¥¨æ•°ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
=======
First we need to open `app/choices/mutations/updateChoice.ts`, update the
zod schema, and add a vote increment.
>>>>>>> 70a4ef1de11636f6d26d6c46ccbd29b5c68fecd5

```diff
const UpdateChoice = z
  .object({
    id: z.number(),
-   name: z.string(),
  })
  .nonstrict()

export default resolver.pipe(
  resolver.zod(UpdateChoice),
  resolver.authorize(),
  async ({id, ...data}) => {
-   const choice = await db.choice.update({where: {id}, data})
+   const choice = await db.choice.update({
+     where: {id},
+     data: {votes: {increment: 1}},
+   })

    return choice
  },
)
```

ã“ã“ã§ `app/pages/questions/[questionId].tsx` ã«æˆ»ã‚Šã€ä»¥ä¸‹ã®ã‚ˆã†ã«

`li` ã« `button` ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

```tsx
<li key={choice.id}>
  {choice.text} - {choice.votes} votes
  <button>Vote</button>
</li>
```

æ¬¡ã«ã€æ›´æ–°ã—ãŸ `updateChoice` Mutation ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ `handleVote` é–¢æ•°ã‚’ä½œæˆã—ã¾ã™ã€‚

```diff
// app/pages/questions/[questionId].tsx
+import updateChoice from "app/choices/mutations/updateChoice"

//...

export const Question = () => {
  const router = useRouter()
  const questionId = useParam("questionId", "number")
  const [deleteQuestionMutation] = useMutation(deleteQuestion)
  const [question] = useQuery(getQuestion, {id: questionId})
+ const [updateChoiceMutation] = useMutation(updateChoice)
+
+ const handleVote = async (id: number) => {
+   try {
+     await updateChoiceMutation({id})
+     refetch()
+   } catch (error) {
+     alert("Error updating choice " + JSON.stringify(error, null, 2))
+   }
+ }

  return (
```

ãã—ã¦ã€`handleVote`ã®ä¸­ã§ä½¿ç”¨ã™ã‚‹é–¢æ•° `refetch` ã‚’è¿”ã™ãŸã‚ã«è³ªå•ã® `useQuery` ã‚³ãƒ¼ãƒ«ã‚’æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```diff
// app/pages/questions/[questionId].tsx

//...
- const [question] = useQuery(getQuestion, {id: questionId})
+ const [question, {refetch}] = useQuery(getQuestion, {id: questionId})
//...
```

æœ€å¾Œã«ã€æ–°ã—ã„ `button` ã«ãã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ï¼

```tsx
<button onClick={() => handleVote(choice.id)}>Vote</button>
```

æœ€çµ‚çš„ãª `Question` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx
export const Question = () => {
  const router = useRouter()
  const questionId = useParam("questionId", "number")
  const [deleteQuestionMutation] = useMutation(deleteQuestion)
  const [question, { refetch }] = useQuery(getQuestion, {
    id: questionId,
  })
  const [updateChoiceMutation] = useMutation(updateChoice)

  const handleVote = async (id: number) => {
    try {
      await updateChoiceMutation({ id })
      refetch()
    } catch (error) {
      alert("Error updating choice " + JSON.stringify(error, null, 2))
    }
  }

  return (
    <>
      <Head>
        <title>Question {question.id}</title>
      </Head>

      <div>
        <h1>{question.text}</h1>
        <ul>
          {question.choices.map((choice) => (
            <li key={choice.id}>
              {choice.text} - {choice.votes} votes
              <button onClick={() => handleVote(choice.id)}>Vote</button>
            </li>
          ))}
        </ul>

        <Link href={`/questions/${question.id}/edit`}>
          <a>Edit</a>
        </Link>

        <button
          type="button"
          onClick={async () => {
            if (window.confirm("This will be deleted")) {
              await deleteQuestionMutation({ id: question.id })
              router.push("/questions")
            }
          }}
          style={{ marginLeft: "0.5rem" }}
        >
          Delete
        </button>
      </div>
    </>
  )
}
```

## æœ€å¾Œã«ã€æ—¢å­˜ã®è³ªå•ã®ç·¨é›†ã®é¸æŠè‚¢ã‚’è¨±å¯ã—ã‚ˆã† {#edit-choices-for-question}

æ—¢å­˜ã®è³ªå•ã® **Edit** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€è³ªå•ã‚’ä½œæˆã™ã‚‹ã®ã¨åŒã˜ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã“ã‚Œã§ã™ã§ã«å®Œäº†ã§ã™ã€‚ã‚ã¨ã¯ Mutation ã‚’æ›´æ–°ã™ã‚‹ã ã‘ã§ã™ã€‚

`app/questions/mutations/updateQuestion.ts` ã‚’é–‹ãã€ä»¥ä¸‹ã®å¤‰æ›´ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

```diff
// app/questions/mutations/updateQuestion.ts
import {resolver} from "blitz"
import db from "db"
import * as z from "zod"

const UpdateQuestion = z
  .object({
    id: z.number(),
    text: z.string(),
+   choices: z.array(
+     z.object({id: z.number().optional(), text: z.string()}).nonstrict(),
+   ),
  })
  .nonstrict()

export default resolver.pipe(
  resolver.zod(UpdateQuestion),
  resolver.authorize(),
  async ({id, ...data}) => {
-   const question = await db.question.update({where: {id}, data})
+   const question = await db.question.update({
+     where: {id},
+     data: {
+       ...data,
+       choices: {
+         upsert: data.choices.map((choice) => ({
+           // Appears to be a prisma bug,
+           // because `|| 0` shouldn't be needed
+           where: {id: choice.id || 0},
+           create: {text: choice.text},
+           update: {text: choice.text},
+         })),
+       },
+     },
+     include: {
+       choices: true,
+     },
+   })

    return question
  },
)
```

<<<<<<< HEAD
[`upsert`](https://www.prisma.io/docs/reference/api-reference/prisma-client-reference#upsert) ã¯ã€ã€Œã“ã®é …ç›®ãŒå­˜åœ¨ã™ã‚Œã°ãã‚Œã‚’æ›´æ–°ã™ã‚‹ã€å­˜åœ¨ã—ãªã‘ã‚Œã°ä½œæˆã™ã‚‹ã€ã¨ã„ã†æ„å‘³ã§ã™ã€‚è³ªå•ã‚’ä½œæˆã™ã‚‹éš›ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ 3 ã¤ã®é¸æŠè‚¢ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’å¿…é ˆã¨ã—ã¦ã„ãªã„ã®ã§ã€ã“ã®ã‚±ãƒ¼ã‚¹ã«ã¯æœ€é©ã§ã™ã€‚å¾Œã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè³ªå•ã‚’ç·¨é›†ã—ã¦åˆ¥ã®é¸æŠè‚¢ã‚’è¿½åŠ ã—ãŸå ´åˆã€ã“ã“ã«ä½œæˆã•ã‚Œã¾ã™ã€‚
=======
[`upsert`](https://www.prisma.io/docs/reference/api-reference/prisma-client-reference#upsert)
is a special operation that means, "If this item exists, update it. Else
create it". This is perfect for this case because we didn't require the
user to add three choices when creating the question. So if later the user
adds another choice by editing the question, then it'll be created here.

## Cleanup {#cleanup}

In order for `yarn tsc` or `git push` to succeed, you'll need to delete
`app/choices/mutations/createChoice.ts` (unused) or update the
CreateChoice zod schema to include the required fields.

## Conclusion {#conclusion}
>>>>>>> 70a4ef1de11636f6d26d6c46ccbd29b5c68fecd5

## ã¾ã¨ã‚ {#conclusion}

ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ğŸ¥³ ã‚ãªãŸã ã‘ã® Blitz ã‚¢ãƒ—ãƒªãŒå®Œæˆã—ã¾ã—ãŸã€‚æ¥½ã—ãéŠã‚“ã ã‚Šã€å‹é”ã¨å…±æœ‰ã—ãŸã‚Šã—ã¦ã¿ã¦ãã ã•ã„ã€‚ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¯çµ‚äº†ã—ã¾ã—ãŸãŒã€æŠ•ç¥¨ã‚¢ãƒ—ãƒªã‚’ã‚ˆã‚Šè‰¯ã„ã‚‚ã®ã«ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿæ¬¡ã®ã“ã¨ã‚’è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

- ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã®è¿½åŠ  (ãƒ’ãƒ³ãƒˆ: `blitz install tailwind` ã‚„ `blitz install chakra-ui` ã‚’è©¦ã—ã¦ã¿ã¦ãã ã•ã„)
- æŠ•ç¥¨ã«é–¢ã™ã‚‹çµ±è¨ˆæƒ…å ±ã‚’è¿½åŠ ã™ã‚‹
- [Render](./deploy-render) ã¾ãŸã¯ [Vercel](./deploy-vercel) ã‚’ã¤ã‹ã£ãŸãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°

ã‚ãªãŸã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¸–ç•Œä¸­ã® Blitz ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¨å…±æœ‰ã—ãŸã„å ´åˆã€Discord ä»¥ä¸Šã«è‰¯ã„å ´æ‰€ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚[discord.blitzjs.com](https://discord.blitzjs.com)ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚ãã—ã¦ã€**#built-with-with-blitz** ãƒãƒ£ãƒ³ãƒãƒ«ã«ãƒªãƒ³ã‚¯ã‚’æŠ•ç¨¿ã—ã¦ã€ã¿ã‚“ãªã§å…±æœ‰ã—ã¾ã—ã‚‡ã†ï¼
